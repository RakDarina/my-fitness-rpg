<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</title>
    <style>
    :root { 
        --primary: #6c5ce7; 
        --bg: #f5f6fa; 
        --success: #00b894; 
        --danger: #d63031;
        --hover-border: #00b894; 
        --active-bg: #e0e0e0;    
    }

    body { 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        background: var(--bg); 
        margin: 0; 
        padding-top: 70px; 
        color: #2d3436;
    }

    /* –®–∞–ø–∫–∞ —Ç–µ–ø–µ—Ä—å –ª—É—á—à–µ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ */
    .header {
        position: fixed; top: 0; left: 0; width: 100%;
        background: white; display: flex; align-items: center; justify-content: space-between;
        padding: 10px 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 1000; box-sizing: border-box;
    }

    .site-title { font-weight: 800; font-size: 1rem; color: #2d3436; display: none; } /* –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞ —É–∑–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
    @media (min-width: 600px) { .site-title { display: block; flex: 1; } }

    .nav { display: flex; gap: 5px; justify-content: center; flex: 2; }
    .nav-btn {
        border: 2px solid transparent; background: none; color: #636e72; font-weight: 600;
        padding: 8px 12px; cursor: pointer; border-radius: 50px; transition: all 0.3s ease; font-size: 14px;
    }
    .nav-btn.active { background-color: var(--active-bg); color: #2d3436; }

    .header-right { flex: 1; text-align: right; }
    .star-counter { background: #ffd700; padding: 5px 12px; border-radius: 20px; font-weight: bold; white-space: nowrap; }

    .tab-content { display: none; padding: 15px; max-width: 800px; margin: 0 auto; }
    .tab-content.active { display: block; }

    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –±–ª–æ–∫–∞ –≥–µ—Ä–æ—è */
    .hero-section { 
        display: flex; flex-direction: column; align-items: center; 
        background: white; padding: 30px 20px; border-radius: 20px; gap: 20px; 
        margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
    }
    @media (min-width: 768px) { .hero-section { flex-direction: row; padding: 40px; } }

    .hero-container { width: 100%; max-width: 300px; display: flex; align-items: center; justify-content: center; }
    .hero-img { max-width: 100%; height: auto; border-radius: 15px; }

    .stats-grid { 
        display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; font-size: 16px; 
        border-top: 1px solid #eee; padding-top: 15px;
    }
    .stat-box { background: #f8f9fa; padding: 10px; border-radius: 10px; border-left: 4px solid var(--primary); }

    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; background: white; padding: 10px; border-radius: 15px; margin-top: 15px; }
    .day { padding: 10px 2px; text-align: center; border-radius: 8px; border: 1px solid #f0f0f0; font-size: 12px; }
    .day.completed { background: #e8f5e9; color: var(--success); font-weight: bold; border-color: var(--success); }
    
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; padding: 10px; box-sizing: border-box; }
    .modal-content { background: white; padding: 20px; border-radius: 20px; width: 100%; max-width: 400px; max-height: 90vh; overflow-y: auto; }
    
    .btn { border: none; padding: 12px; border-radius: 12px; color: white; cursor: pointer; width: 100%; font-weight: bold; transition: 0.2s; font-size: 15px; }
    .btn-add { background-color: var(--primary); }
    .btn-undo { background-color: var(--danger); }

    .item-card { background: white; padding: 12px; margin-bottom: 10px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid #f0f0f0; }
    .item-info { display: flex; align-items: center; gap: 12px; }
    .item-img-preview { width: 45px; height: 45px; object-fit: cover; border-radius: 8px; background: #eee; flex-shrink: 0; }
    .edit-link { font-size: 11px; color: var(--primary); cursor: pointer; text-decoration: underline; margin-left: 5px; opacity: 0.7; }
    </style>
</head>
<body>

    <header class="header">
        <div class="site-title">GlowUp RPG</div>
        <nav class="nav">
            <button class="nav-btn active" data-tab="tab-data">–ì–µ—Ä–æ–π</button>
            <button class="nav-btn" data-tab="tab-tasks">–¶–µ–ª–∏</button>
            <button class="nav-btn" data-tab="tab-shop">–ú–∞–≥–∞–∑–∏–Ω</button>
        </nav>
        <div class="header-right">
            <div class="star-counter">‚≠êÔ∏è <span id="starDisplay">0</span></div>
        </div>
    </header>

    <div id="tab-data" class="tab-content active">
        <div class="hero-section">
            <div class="hero-container">
                <img id="characterImage" src="stage1.png" alt="–ì–µ—Ä–æ–π" class="hero-img">
            </div>
            <div class="stats-grid" id="currentStats"><div>–î–æ–±–∞–≤—å—Ç–µ –∑–∞–º–µ—Ä—ã</div></div>
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="btn btn-add" id="openAddStats">‚ûï –ó–∞–º–µ—Ä—ã</button>
            <button class="btn btn-undo" id="openHistory" style="background:#a29bfe; width: 60px;">üìú</button>
        </div>
    </div>

    <div id="tab-tasks" class="tab-content">
        <div style="background: white; padding: 15px; border-radius: 15px; margin-bottom: 20px; text-align: center;">
            <b>1 —á–∞—Å –¥–æ—Ä–æ–∂–∫–∏ = 1 ‚≠êÔ∏è</b>
            <div style="display:flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                <button id="prevMonth" style="border:none; background:none; cursor:pointer; font-size: 20px;">‚Äπ</button>
                <span id="monthYear" style="font-weight:bold;"></span>
                <button id="nextMonth" style="border:none; background:none; cursor:pointer; font-size: 20px;">‚Ä∫</button>
            </div>
            <div class="calendar-grid" id="calendar"></div>
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button class="btn" style="background: var(--success);" id="doTask">‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
                <button class="btn btn-undo" id="undoTask">‚ùå –û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>

        <div style="font-weight:bold; margin-bottom:10px;">üéØ –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ü–µ–ª–∏</div>
        <div id="goalsList"></div>
        <button class="btn btn-add" id="openAddGoal" style="background: none; border: 2px dashed #ccc; color: #999;">+ –î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å</button>

        <div style="font-weight:bold; margin-top:25px; margin-bottom:10px;">üçî –§–∞—Å—Ç—Ñ—É–¥</div>
        <div class="item-card" style="background: #fff5f5; border: 1px solid #ff7675; flex-direction: column; gap: 10px;">
            <button class="btn btn-undo" id="btnFastFood">üçü –Ø —Å—ä–µ–ª–∞ –ª–∏—à–Ω–µ–µ (-1 ‚≠êÔ∏è)</button>
        </div>
    </div>

    <div id="tab-shop" class="tab-content">
        <div style="font-weight:bold; margin-bottom:10px;">üõí –í–∏—à–ª–∏—Å—Ç</div>
        <div id="shopList"></div>
        <div style="font-weight:bold; margin:20px 0 10px; opacity: 0.6;">üéí –ö—É–ø–ª–µ–Ω–æ</div>
        <div id="inventoryList"></div>
        <button class="btn btn-add" id="openAddItem" style="margin-top:20px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∂–µ–ª–∞–Ω–∏–µ</button>
    </div>

    <div id="addStatsModal" class="modal"><div class="modal-content"><form id="statsForm"><h3>–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</h3><input type="number" step="0.1" name="weight" placeholder="–í–µ—Å (–∫–≥)" required><input type="number" step="0.1" name="waist" placeholder="–¢–∞–ª–∏—è (—Å–º)"><input type="number" step="0.1" name="hips" placeholder="–ë–µ–¥—Ä–∞ (—Å–º)"><button type="submit" class="btn btn-add">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button type="button" class="btn btn-undo close-modal" style="margin-top:8px">–û—Ç–º–µ–Ω–∞</button></form></div></div>

    <div id="addGoalModal" class="modal"><div class="modal-content"><form id="goalForm"><h3>üéØ –ù–æ–≤–∞—è —Ü–µ–ª—å</h3><input type="text" name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏" required><input type="number" name="reward" placeholder="–ù–∞–≥—Ä–∞–¥–∞ (–∑–≤–µ–∑–¥)" required><button type="submit" class="btn btn-add">–î–æ–±–∞–≤–∏—Ç—å</button><button type="button" class="btn btn-undo close-modal" style="margin-top:8px">–û—Ç–º–µ–Ω–∞</button></form></div></div>

    <div id="addItemModal" class="modal"><div class="modal-content"><form id="itemForm"><h3>üõç –ü—Ä–µ–¥–º–µ—Ç</h3><input type="hidden" name="id"><input type="text" name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required><input type="number" name="price" placeholder="–¶–µ–Ω–∞ –∑–≤–µ–∑–¥" required><input type="url" name="link" placeholder="–°—Å—ã–ª–∫–∞"><input type="text" name="imgUrl" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ"><button type="submit" class="btn btn-add" id="itemSubmitBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button type="button" class="btn btn-undo close-modal" style="margin-top:8px">–û—Ç–º–µ–Ω–∞</button></form></div></div>

    <div id="historyModal" class="modal"><div class="modal-content"><h3>–ò—Å—Ç–æ—Ä–∏—è</h3><div id="historyList"></div><button class="btn btn-undo close-modal">–ó–∞–∫—Ä—ã—Ç—å</button></div></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var state = JSON.parse(localStorage.getItem('fitness_rpg_v5')) || {
                stars: 0, stats: [], completedDates: [], shop: [], inventory: [], goals: []
            };

            var save = function() {
                localStorage.setItem('fitness_rpg_v5', JSON.stringify(state));
                document.getElementById('starDisplay').innerText = state.stars;
            };

            var closeModal = function() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); };
            var openModal = function(id) { document.getElementById(id).style.display = 'flex'; };

            // –ù–ê–í–ò–ì–ê–¶–ò–Ø
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.onclick = function() {
                    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    document.getElementById(this.dataset.tab).classList.add('active');
                    this.classList.add('active');
                    if (this.dataset.tab === 'tab-tasks') { renderCalendar(); renderGoals(); }
                    if (this.dataset.tab === 'tab-shop') renderShop();
                };
            });

            // –ü–ï–†–°–û–ù–ê–ñ
            var updateCharacter = function(weight) {
                var img = document.getElementById('characterImage');
                var w = parseFloat(weight);
                var stage = "stage1.png";
                if (w >= 68) stage = "stage6.png";
                else if (w >= 65) stage = "stage5.png";
                else if (w >= 62) stage = "stage4.png";
                else if (w >= 59) stage = "stage3.png";
                else if (w >= 56) stage = "stage2.png";
                img.src = stage;
            };

            // –°–¢–ê–¢–ò–°–¢–ò–ö–ê
            document.getElementById('statsForm').onsubmit = function(e) {
                e.preventDefault();
                state.stats.push({
                    id: Date.now(), date: new Date().toLocaleDateString(),
                    weight: e.target.weight.value, waist: e.target.waist.value, hips: e.target.hips.value
                });
                save(); renderStats(); closeModal(); e.target.reset();
            };

            var renderStats = function() {
                var last = state.stats[state.stats.length - 1];
                if (!last) return;
                document.getElementById('currentStats').innerHTML =
                    `<div class="stat-box">‚öñÔ∏è –í–µ—Å: ${last.weight} –∫–≥</div>
                     <div class="stat-box">üìè –¢–∞–ª–∏—è: ${last.waist} —Å–º</div>
                     <div class="stat-box">üìè –ë–µ–¥—Ä–∞: ${last.hips} —Å–º</div>
                     <div style="font-size:10px; opacity:0.5; padding:5px;">${last.date}</div>`;
                updateCharacter(last.weight);
            };

            // –ú–ê–ì–ê–ó–ò–ù
            document.getElementById('itemForm').onsubmit = function(e) {
                e.preventDefault();
                var id = e.target.id.value;
                var data = { id: id ? parseInt(id) : Date.now(), name: e.target.name.value, price: parseInt(e.target.price.value), link: e.target.link.value, imgUrl: e.target.imgUrl.value };
                if (id) {
                    var idx = state.shop.findIndex(i => i.id === data.id);
                    state.shop[idx] = data;
                } else { state.shop.push(data); }
                save(); renderShop(); closeModal();
            };

            window.editItem = function(id) {
                var item = state.shop.find(i => i.id === id);
                var f = document.getElementById('itemForm');
                f.id.value = item.id; f.name.value = item.name; f.price.value = item.price;
                f.link.value = item.link || ""; f.imgUrl.value = item.imgUrl || "";
                openModal('addItemModal');
            };

            window.buyItem = function(id) {
                var idx = state.shop.findIndex(i => i.id === id);
                if (state.stars >= state.shop[idx].price) {
                    state.stars -= state.shop[idx].price;
                    state.inventory.push(state.shop[idx]);
                    state.shop.splice(idx, 1);
                    save(); renderShop();
                } else { alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤–µ–∑–¥!"); }
            };

            var renderShop = function() {
                var sList = document.getElementById('shopList'); sList.innerHTML = '';
                state.shop.forEach(item => {
                    var img = item.imgUrl ? `<img src="${item.imgUrl}" class="item-img-preview">` : `<div class="item-img-preview"></div>`;
                    var name = item.link ? `<a href="${item.link}" target="_blank" style="color:var(--primary); text-decoration:none;"><b>${item.name} üîó</b></a>` : `<b>${item.name}</b>`;
                    sList.innerHTML += `<div class="item-card"><div class="item-info">${img}<div>${name}<span class="edit-link" onclick="window.editItem(${item.id})">—Ä–µ–¥.</span><br><small>${item.price} ‚≠êÔ∏è</small></div></div>
                        <div><button onclick="window.deleteShopItem(${item.id})" style="background:none; border:none; cursor:pointer;">üóë</button>
                        <button class="btn" style="width:auto; padding:5px 10px; background:var(--primary); margin-left:5px;" onclick="window.buyItem(${item.id})">–í–∑—è—Ç—å</button></div></div>`;
                });
                var iList = document.getElementById('inventoryList'); iList.innerHTML = '';
                state.inventory.forEach(item => {
                    iList.innerHTML += `<div class="item-card"><span>${item.name}</span><button class="btn btn-undo" style="width:auto; padding:5px 10px;" onclick="window.returnItem(${item.id})">–í–µ—Ä–Ω—É—Ç—å</button></div>`;
                });
            };
            window.deleteShopItem = function(id) { state.shop = state.shop.filter(i => i.id !== id); save(); renderShop(); };
            window.returnItem = function(id) {
                var idx = state.inventory.findIndex(i => i.id === id);
                state.stars += state.inventory[idx].price;
                state.shop.push(state.inventory[idx]);
                state.inventory.splice(idx, 1);
                save(); renderShop();
            };

            // –ö–ê–õ–ï–ù–î–ê–†–¨
            var currDate = new Date();
            var renderCalendar = function() {
                var grid = document.getElementById('calendar'); grid.innerHTML = '';
                var m = currDate.getMonth(), y = currDate.getFullYear();
                document.getElementById('monthYear').innerText = ["–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å", "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"][m] + ' ' + y;
                var days = new Date(y, m + 1, 0).getDate();
                for (var i = 1; i <= days; i++) {
                    var d = document.createElement('div'); d.className = 'day';
                    var key = y + '-' + m + '-' + i;
                    if (state.completedDates.indexOf(key) !== -1) d.classList.add('completed');
                    d.innerText = i; grid.appendChild(d);
                }
            };
            document.getElementById('prevMonth').onclick = () => { currDate.setMonth(currDate.getMonth()-1); renderCalendar(); };
            document.getElementById('nextMonth').onclick = () => { currDate.setMonth(currDate.getMonth()+1); renderCalendar(); };
            document.getElementById('doTask').onclick = () => {
                var d = new Date(), key = d.getFullYear()+'-'+d.getMonth()+'-'+d.getDate();
                if(!state.completedDates.includes(key)) { state.completedDates.push(key); state.stars++; save(); renderCalendar(); }
            };

            // –¶–ï–õ–ò
            document.getElementById('goalForm').onsubmit = function(e) {
                e.preventDefault();
                state.goals.push({ id: Date.now(), name: e.target.name.value, reward: parseInt(e.target.reward.value) });
                save(); renderGoals(); closeModal(); e.target.reset();
            };
            window.renderGoals = function() {
                var gList = document.getElementById('goalsList'); gList.innerHTML = '';
                state.goals.forEach(g => {
                    gList.innerHTML += `<div class="item-card"><div><b>${g.name}</b> <small style="color:var(--success)">+${g.reward}‚≠êÔ∏è</small></div>
                        <div style="display:flex; gap:5px;"><button onclick="window.completeGoal(${g.id})" class="btn" style="background:var(--success); width:auto; padding:5px 10px;">‚úÖ</button>
                        <button onclick="window.deleteGoal(${g.id})" class="btn btn-undo" style="width:auto; padding:5px 10px;">üóë</button></div></div>`;
                });
            };
            window.completeGoal = function(id) {
                var g = state.goals.find(x => x.id === id);
                state.stars += g.reward; state.goals = state.goals.filter(x => x.id !== id);
                save(); renderGoals();
            };
            window.deleteGoal = function(id) { state.goals = state.goals.filter(x => x.id !== id); save(); renderGoals(); };

            // –ö–Ω–æ–ø–∫–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è
            document.getElementById('openAddStats').onclick = () => openModal('addStatsModal');
            document.getElementById('openAddGoal').onclick = () => openModal('addGoalModal');
            document.getElementById('openAddItem').onclick = () => { document.getElementById('itemForm').reset(); document.getElementById('itemForm').id.value = ""; openModal('addItemModal'); };
            document.getElementById('openHistory').onclick = () => { renderHistory(); openModal('historyModal'); };
            document.querySelectorAll('.close-modal').forEach(b => b.onclick = closeModal);
            document.getElementById('btnFastFood').onclick = () => { state.stars--; save(); };

            var renderHistory = function() {
                var hList = document.getElementById('historyList'); hList.innerHTML = '';
                state.stats.slice().reverse().forEach(s => {
                    hList.innerHTML += `<div class="item-card" style="font-size:13px;"><b>${s.date}</b>: ${s.weight}–∫–≥ <button onclick="window.deleteStat(${s.id})" style="border:none; color:red;">üóë</button></div>`;
                });
            };
            window.deleteStat = function(id) { state.stats = state.stats.filter(s => s.id !== id); save(); renderStats(); renderHistory(); };

            save(); renderStats();
        });
    </script>
</body>
</html>
