<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</title>
    <style>
    :root { 
        --primary: #6c5ce7; 
        --bg: #f5f6fa; 
        --success: #00b894; 
        --danger: #d63031;
        --active-bg: #e0e0e0;    
    }

    body { 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        background: var(--bg); 
        margin: 0; 
        padding-top: 70px; 
        height: 100vh;
        overflow: hidden; /* –§–∏–∫—Å–∏—Ä—É–µ–º —ç–∫—Ä–∞–Ω, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –ª–∏—à–Ω–µ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
    }

    /* –®–∞–ø–∫–∞ */
    .header {
        position: fixed; top: 0; left: 0; width: 100%;
        background: white; display: flex; align-items: center; justify-content: space-between;
        padding: 10px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 1000; box-sizing: border-box;
    }
    .site-title { font-weight: 800; font-size: 1.2rem; color: #2d3436; }
    .nav { display: flex; gap: 10px; }
    .nav-btn {
        border: 2px solid transparent; background: none; color: #636e72; font-weight: 600;
        padding: 8px 15px; cursor: pointer; border-radius: 50px; transition: 0.3s;
    }
    .nav-btn.active { background-color: var(--active-bg); color: #2d3436; }
    .star-counter { background: #ffd700; padding: 5px 15px; border-radius: 20px; font-weight: bold; }

    /* –ì–ª–∞–≤–Ω—ã–π –º–∞–∫–µ—Ç –∏–∑ 3-—Ö –±–ª–æ–∫–æ–≤ */
    .main-layout {
        display: flex;
        height: calc(100vh - 90px);
        padding: 20px;
        gap: 20px;
        box-sizing: border-box;
    }

    /* –ë–õ–û–ö 1: –ü–µ—Ä—Å–æ–Ω–∞–∂ —Å–ª–µ–≤–∞ */
    .character-block {
        flex: 1.2;
        background: white;
        border-radius: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        overflow: hidden;
    }
    .hero-img { 
        max-height: 95%; 
        max-width: 95%; 
        object-fit: contain; 
    }

    /* –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∏ –∫–Ω–æ–ø–æ–∫ */
    .side-column {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    /* –ë–õ–û–ö 3: –î–∞–Ω–Ω—ã–µ —Å–≤–µ—Ä—Ö—É —Å–ø—Ä–∞–≤–∞ */
    .data-block {
        flex: 2;
        background: white;
        border-radius: 24px;
        padding: 25px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        overflow-y: auto;
    }
    .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 15px;
    }
    .stat-item {
        background: #f8f9ff;
        padding: 15px;
        border-radius: 15px;
        border: 1px solid #edf0f7;
    }
    .stat-label { font-size: 0.8rem; color: #b2bec3; margin-bottom: 5px; }
    .stat-value { font-size: 1.1rem; font-weight: 700; color: #2d3436; }

    /* –ë–õ–û–ö 2: –ö–Ω–æ–ø–∫–∏ —Å–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞ */
    .actions-block {
        background: white;
        border-radius: 24px;
        padding: 20px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .btn {
        border: none; padding: 16px; border-radius: 16px; font-weight: 700;
        cursor: pointer; transition: 0.2s; font-size: 1rem;
    }
    .btn-primary { background: var(--primary); color: white; }
    .btn-secondary { background: #f1f2f6; color: #2d3436; }
    .btn:active { transform: scale(0.98); }

    /* –í–∫–ª–∞–¥–∫–∏ */
    .tab-content { display: none; height: 100%; }
    .tab-content.active { display: block; }

    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; }
    .modal-content { background: white; padding: 30px; border-radius: 24px; width: 90%; max-width: 400px; }
    .modal-content input { width: 100%; margin-bottom: 12px; padding: 14px; border: 1px solid #ddd; border-radius: 12px; box-sizing: border-box; }

    @media (max-width: 900px) {
        .main-layout { flex-direction: column; overflow-y: auto; height: auto; }
        .
        character-block { height: 450px; flex: none; }
        body { overflow: auto; }
    }
    </style>
</head>
<body>

    <header class="header">
        <div class="site-title">–ú–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
        <nav class="nav">
            <button class="nav-btn active" data-tab="tab-data">–ì–ª–∞–≤–Ω–∞—è</button>
            <button class="nav-btn" data-tab="tab-tasks">–ó–∞–¥–∞–Ω–∏—è</button>
            <button class="nav-btn" data-tab="tab-shop">–ú–∞–≥–∞–∑–∏–Ω</button>
        </nav>
        <div class="star-counter">‚≠êÔ∏è <span id="starDisplay">0</span></div>
    </header>

    <div id="tab-data" class="tab-content active">
        <div class="main-layout">
            
            <!-- –ë–õ–û–ö 1: –ü–ï–†–°–û–ù–ê–ñ (–°–õ–ï–í–ê) -->
            <div class="character-block">
                <img id="characterImage" src="stage1.png" alt="–ì–µ—Ä–æ–π" class="hero-img">
            </div>

            <!-- –ü–†–ê–í–ê–Ø –ß–ê–°–¢–¨ (–ë–õ–û–ö–ò 3 –ò 2) -->
            <div class="side-column">
                
                <!-- –ë–õ–û–ö 3: –î–ê–ù–ù–´–ï (–°–í–ï–†–•–£) -->
                <div class="data-block">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <h3 style="margin:0">–¢–µ–∫—É—â–∏–µ –∑–∞–º–µ—Ä—ã</h3>
                        <span id="lastDateText" style="color:#b2bec3; font-size:0.8rem;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>
                    </div>
                    <div class="stats-grid" id="currentStats">
                        <div class="stat-item"><div class="stat-label">–í–µ—Å</div><div class="stat-value">‚Äî</div></div>
                        <div class="stat-item"><div class="stat-label">–ñ–∏—Ä %</div><div class="stat-value">‚Äî</div></div>
                        <div class="stat-item"><div class="stat-label">–ë–µ–ª–æ–∫</div><div class="stat-value">‚Äî</div></div>
                        <div class="stat-item"><div class="stat-label">–í–æ–¥–∞</div><div class="stat-value">‚Äî</div></div>
                        <div class="stat-item"><div class="stat-label">–¢–∞–ª–∏—è</div><div class="stat-value">‚Äî</div></div>
                        <div class="stat-item"><div class="stat-label">–ë–∏—Ü–µ–ø—Å</div><div class="stat-value">‚Äî</div></div>
                    </div>
                </div>

                <!-- –ë–õ–û–ö 2: –ö–ù–û–ü–ö–ò (–°–ù–ò–ó–£) -->
                <div class="actions-block">
                    <button class="btn btn-primary" id="openAddStats">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</button>
                    <button class="btn btn-secondary" id="openHistory">üìú –ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø–∏—Å–µ–π</button>
                </div>

            </div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–ö–ê -->
    <div id="addStatsModal" class="modal">
        <div class="modal-content">
            <form id="statsForm">
                <h3 style="margin-top:0">–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</h3>
                <input type="number" step="0.1" name="weight" placeholder="–í–µ—Å (–∫–≥)" required>
                <input type="number" step="0.1" name="fat" placeholder="–ñ–∏—Ä (%)">
                <input type="number" step="0.1" name="protein" placeholder="–ë–µ–ª–æ–∫">
                <input type="number" step="0.1" name="water" placeholder="–í–æ–¥–∞">
                <input type="number" step="0.1" name="waist" placeholder="–¢–∞–ª–∏—è (—Å–º)">
                <input type="number" step="0.1" name="bicep" placeholder="–ë–∏—Ü–µ–ø—Å (—Å–º)">
                <button type="submit" class="btn btn-primary" style="width:100%">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" class="btn btn-secondary close-modal" style="width:100%; margin-top:8px">–û—Ç–º–µ–Ω–∞</button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var state = JSON.parse(localStorage.getItem('fitness_rpg_v5')) || {
                stars: 0, stats: [], completedDates: []
            };

            var save = function() {
                localStorage.setItem('fitness_rpg_v5', JSON.stringify(state));
                document.getElementById('starDisplay').innerText = state.stars;
            };

            var updateCharacter = function(weight) {
                var img = document.getElementById('characterImage');
                var w = parseFloat(weight);
                var stage = "stage1.png";
                if (w >= 68) stage = "stage6.png";
                else if (w >= 65) stage = "stage5.png";
                else if (w >= 62) stage = "stage4.png";
                else if (w >= 59) stage = "stage3.png";
                else if (w >= 56) stage = "stage2.png";
                img.src = stage;
            };

            var renderStats = function() {
                var last = state.stats[state.stats.length - 1];
                if (!last) return;
                document.getElementById('lastDateText').innerText = last.date;
                document.getElementById('currentStats').innerHTML = `
                    <div class="stat-item"><div class="stat-label">–í–µ—Å</div><div class="stat-value">${last.weight} –∫–≥</div></div>
                    <div class="stat-item"><div class="stat-label">–ñ–∏—Ä %</div><div class="stat-value">${last.fat || '‚Äî'} %</div></div>
                    <div class="stat-item"><div class="stat-label">–ë–µ–ª–æ–∫</div><div class="stat-value">${last.protein || '‚Äî'}</div></div>
                    <div class="stat-item"><div class="stat-label">–í–æ–¥–∞</div><div class="stat-value">${last.water || '‚Äî'}</div></div>
                    <div class="stat-item"><div class="stat-label">–¢–∞–ª–∏—è</div><div class="stat-value">${last.waist || '‚Äî'} —Å–º</div></div>
                    <div class="stat-item"><div class="stat-label">–ë–∏—Ü–µ–ø—Å</div><div class="stat-value">${last.bicep || '‚Äî'} —Å–º</div></div>
                `;
                updateCharacter(last.weight);
            };

            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º
            document.querySelectorAll('.nav-btn').forEach(function(btn) {
                btn.onclick = function() {
                    document.querySelectorAll('.tab-content').forEach(function(t) { t.classList.remove('active'); });
                    document.querySelectorAll('.nav-btn').forEach(function(b) { b.classList.remove('active'); });
                    document.getElementById(btn.getAttribute('data-tab')).classList.add('active');
                    btn.classList.add('active');
                };
            });

            document.getElementById('openAddStats').onclick = function() { document.getElementById('addStatsModal').style.display = 'flex'; };
            document.querySelectorAll('.close-modal').forEach(function(b) { 
                b.onclick = function() { document.querySelectorAll('.modal').forEach(function(m) { m.style.display = 'none'; }); }; 
            });

            document.getElementById('statsForm').onsubmit = function(e) {
                e.preventDefault();
                var entry = {
                    date: new Date().toLocaleDateString(),
                    weight: e.target.weight.value, fat: e.target.fat.value,
                    protein: e.target.protein.value, water: e.target.water.value,
                    waist: e.target.waist.value, bicep: e.target.bicep.value
                };
                state.stats.push(entry);
                save(); renderStats();
                document.getElementById('addStatsModal').style.display = 'none';
                e.target.reset();
            };

            save(); renderStats();
        });
    </script>
</body>
</html>
